// smn/user-ticket/backend/controllers/ticketController.js
import asyncHandler from 'express-async-handler';import Ticket from '../models/ticketModel.js';import Counter from '../models/counterModel.js';async function getIncrementingId(){const e=await Counter.findOne({},"ticketId");if(!e)return await Counter.create({ticketId:1}),1;const t=e.ticketId+1;return await Counter.updateOne({},{ticketId:t}),t}import asyncHandler from"express-async-handler";import Ticket from"../models/ticketModel.js";import Counter from"../models/counterModel.js";export const createTicket=asyncHandler(async(e,t)=>{console.log("Received request body:",e.body);try{const{user_id:s,mobile_number:o,location:n,issue_type:r,comments:c}=e.body;if(!(s&&o&&n&&r&&c))throw t.status(400),new Error("Please provide all required fields");const a=await getIncrementingId(),i=await Ticket.create({user_id:s,mobile_number:o,location:n,issue_type:r,comments:c,ticket_id:`TKT-${a}`,type:"user"});console.log("Created ticket:",i),t.status(201).json({success:!0,data:i})}catch(e){console.error("Error creating ticket:",e),t.status(400).json({success:!1,error:e.message})}});export const getAllTickets=asyncHandler(async(e,t)=>{const s=await Ticket.find({type:"user"});t.status(200).json({success:!0,count:s.length,data:s})});